[build]
  command = "pnpm run build"
  # 使用 pnpm 安装依赖：更快、更节省空间
  install = "npm install -g pnpm@latest && pnpm install --frozen-lockfile --prefer-offline"
  # 注意：使用 @netlify/plugin-nextjs 时不需要设置 publish 目录
  # 插件会自动处理 Next.js 构建输出

[build.environment]
  NODE_VERSION = "22.21.1"
  # pnpm 配置
  PNPM_FLAGS = "--frozen-lockfile --prefer-offline"
  # 禁用进度条和详细日志，减少输出时间
  NPM_CONFIG_PROGRESS = "false"
  NPM_CONFIG_LOGGER = "error"
  # 增加超时时间到 5 分钟（300000 毫秒）
  NPM_CONFIG_FETCH_TIMEOUT = "300000"
  # 增加重试次数到 5 次
  NPM_CONFIG_FETCH_RETRIES = "5"
  # pnpm 网络并发数
  PNPM_NETWORK_CONCURRENCY = "5"
  # Next.js 配置：Netlify 部署时不需要 basePath（除非是子目录部署）
  # 如果需要部署到子目录，设置为对应的路径，例如：NEXT_PUBLIC_BASE_PATH = "/your-subdirectory"
  NEXT_PUBLIC_BASE_PATH = ""

